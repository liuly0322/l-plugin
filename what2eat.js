import plugin from '../../lib/plugins/plugin.js'

const basic_food = [
  'è‚¯å¾·åŸº',
  'éº¦å½“åŠ³',
  'æ±‰å ¡ç‹',
  'è‰¾æ¯”å…‹',
  'å¿…èƒœå®¢',
  'æ–¹ä¾¿é¢',
  'é¸¡æ’',
  'ä¸€ç‚¹ç‚¹',
  'èµ¤å‚äº­',
  'å¡æ—ºå¡',
  'çƒ¤å†·é¢',
  'æ‰‹æŠ“é¥¼',
  'ä¸œåŒºä¸œè‹‘é¤å…',
  'ä¸œåŒºé£å‘³é¤å…',
  'ä¸œåŒºæ˜Ÿåº§é¤å…',
  'ä¸œåŒºå­¦ç”Ÿé¤å…',
  'ä¸œåŒºç¾é£Ÿå¹¿åœº',
  'è¥¿åŒºå­¦ç”Ÿé¤å…',
  'è¥¿åŒºè¥¿è‹‘é¤å…',
  'è¥¿åŒºèŠ³åé¤å…',
  'è¥¿åŒºè¥¿ä¸‰é¤å…',
  'è¥¿åŒºé‡‘æ¡”å›­',
  'è¥¿åŒºæ­£é˜³æ¥¼',
  'ä¸­åŒºæ¡ƒæè‹‘',
  'è€ä¹¡é¸¡',
  'ç´«ç‡•ç™¾å‘³é¸¡',
  'ä¸œåŒ—ç‹é£Ÿåºœ',
  'æ— é”¡æ±¤åŒ…',
  'å·´èœ€äººå®¶',
  'è€åœ°æ–¹å·èœé¦†',
  'é¸¡å…¬ç…²',
  'æ·®å—ç‰›è‚‰æ±¤',
  'å°é«˜ç±³çº¿',
  'è‚¥å”é”…è´´',
  'é‡å­å’–å•¡',
  'æ¥ä¸€æ¯',
  'è´¹æ¯”æ¬§',
  'è’¸å°çš–',
  'å¼ äº®éº»è¾£çƒ«',
  'æ¨å›½ç¦éº»è¾£çƒ«',
  'åºå·å¤ªå¤ª',
  'æ¼«ä¹åŸ',
  'é¦™è¾£è™¾',
  'æµ·åº•æ',
  'æ²™å¿å°åƒ',
  'å‡‰ç™½å¼€',
  'éº»è¾£é¦™é”…',
  'è¥¿çº¢æŸ¿ç‚’é¸¡è›‹',
  'åœ°ä¸‰é²œ',
  'æ°´ç…®è‚‰ç‰‡',
  'å›é”…è‚‰',
  'ç³–é†‹é‡Œè„Š',
  'è‘±ç…è±†è…',
  'é±¼é¦™è‚‰ä¸',
  'ç³–é†‹é‡Œè„Š',
  'è¾£æ¤’ç‚’è‚‰',
  'å­œç„¶ç‰›è‚‰',
  'é¦™èœç‰›è‚‰',
  'å°ç‚’è‚‰',
  'æ´‹è‘±ç‚’è‚‰',
  'é…¸è¾£åœŸè±†ä¸',
  'é†‹æºœåœŸè±†ä¸',
  'å¯ä¹é¸¡ç¿…',
  'é…±ç‰›è‚‰',
  'è¿‡æ¡¥ç±³çº¿',
  'é±¼',
  'å°é…¥è‚‰',
  'é”…åŒ…è‚‰',
  'ç²‰è’¸è‚‰',
  'çº¢çƒ§è‚‰',
  'çº¢çƒ§èŒ„å­',
  'ç²‰è’¸æ’éª¨',
  'æ¢…èœæ‰£è‚‰',
  'åœŸè±†ç‚–ç‰›è‚‰',
  'è›‹ç‚’é¥­',
  'é¢æ¡',
  'åœŸå®¶é…±é¦™é¥¼',
  'å­”åºœä¸€å“é”…',
  'å°¼å…‹æ–¯',
  'é±¼æ‚ç«é”…',
  'æ·®å—ç²‰ä¸æ±¤',
  'å“¨å­é¢',
  'è‚¥è¥¿è·¯å°æ‘Š',
  'çƒ§çƒ¤',
  'éšåˆ›',
  'è€ç«',
  'ç½—æ£®',
  'åè±å£«',
  'ç‘å¹¸å’–å•¡',
  'é‡‡è¶è½©',
  'çš–åŒ—åœ°é”…é¸¡',
  'æ·®æ²³è·¯æ­¥è¡Œè¡—',
  'æ³¡é¢',
  'è‚‰å¤¹é¦',
  'é‡åº†å°é¢',
  'ğŸ®',
  'ğŸ•',
  'è©¹è®°',
  'å°é¸¡ç‚–è˜‘è‡',
  'é¸¡ç±³é¥­',
  'è€åŒ—äº¬é¸¡è‚‰å·',
  'ğŸ”',
  'ğŸ',
  'ğŸŒ­',
  'ğŸ¥˜',
  'ğŸŸ',
  'ğŸœ',
  'ğŸ¤',
  'ğŸ¥®',
  'ğŸ¨ğŸ¦ğŸ§',
  'åŒ…å­',
  'é±¼æ‚',
  'ç‰›æ‚',
  'è¥¿åŒºå­¦ç”Ÿé£Ÿå ‚ä¸€æ¥¼å°ç«é”…',
  'ä¸œåŒºæ˜Ÿåº§é…¸èœé±¼',
  'è¥¿è‹‘çŒªè‚šé¸¡',
  'èŠ³åé»„ç„–é¸¡',
  'ä¸œåŒºç¾é£Ÿå¹¿åœºæ— éª¨é±¼/çƒ¤é±¼é¥­',
  'ç»¿è±†è–ç±³ç²¥',
]

export class what2eat extends plugin {
  constructor() {
    super({
      name: 'what2eat',
      dsc: 'ä»Šå¤©åƒä»€ä¹ˆ',
      event: 'message',
      priority: 5000,
      rule: [
        {
          reg: '^å’±?(ä»Šå¤©|æ˜å¤©|[æ—©ä¸­åˆæ™š][ä¸Šé¥­é¤åˆ]|æ—©ä¸Š|å¤œå®µ|ä»Šæ™š)åƒ(ä»€ä¹ˆ|å•¥|ç‚¹å•¥)',
          fnc: 'what2eat',
        },
        {
          reg: '^æ·»åŠ é£Ÿç‰©',
          fnc: 'addFood',
        },
        {
          reg: '^åˆ é™¤é£Ÿç‰©',
          fnc: 'deleteFood',
        },
      ],
    })
  }
  
  async validate() {
    if (!this.e.isGroup) {
      this.reply('è¯·ç¾¤èŠå‘é€')
      return false
    }
    return true
  }
  
  getKey () {
    return `Yz:what2eat:foods:${this.e.group_id}`
  }
  
  async addFood() {
    if (!this.validate()) return
    const key = this.getKey()
    const foods = this.e.msg.split(' ').slice(1)
    foods.forEach(async (food) => {
      await redis.sAdd(key, food)
    })
    await this.reply('æ·»åŠ æˆåŠŸï¼')
  }

  async deleteFood() {
    if (!this.validate()) return
    const key = this.getKey()
    const foods = this.e.msg.split(' ').slice(1)
    foods.forEach(async (food) => {
      await redis.sRem(key, food)
    })
    await this.reply('åˆ é™¤æˆåŠŸï¼')
  }

  async what2eat() {
    let food = basic_food
    if (this.validate()) {
      const key = this.getKey()
      const group_food = await redis.sMembers(key)
      food = this.e.msg.split(' ')[0]?.includes('å’±')
        ? group_food
        : [...basic_food, ...group_food]
    }
    

    if (!food || food.length == 0) return

    const results = new Array(5)
      .fill('')
      .map(() => food[Math.floor(Math.random() * food.length)])
    const result = results.join('|')
    await this.reply(`æ¨èå°è¯•ï¼š${result}`, false, { at: true })
  }
}
